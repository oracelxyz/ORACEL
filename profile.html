<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ORACEL â€“ Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; }
    h1, h2, h3 { font-family: 'Space Grotesk', sans-serif; }
  </style>
</head>

<body class="text-white overflow-x-hidden">

<!-- ðŸŒŒ GLOBAL BACKGROUND -->
<div class="fixed inset-0 -z-10">
  <div class="absolute inset-0 bg-gradient-to-br from-[#040817] via-[#0A1440] to-[#020617]"></div>
  <div class="absolute inset-0 opacity-[0.25] bg-[url('https://grainy-gradients.vercel.app/noise.svg')]"></div>
</div>

<div class="flex min-h-screen">

  <!-- SIDEBAR -->
  <aside class="w-64 bg-black/40 backdrop-blur-xl border-r border-blue-400/20 hidden md:flex flex-col justify-between">
    <div>
      <div class="p-6 flex items-center gap-3">
        <img src="logo-oracel.png" class="w-9 h-9 rounded-lg">
        <span class="text-lg font-semibold tracking-widest text-blue-400">ORACEL</span>
      </div>

      <nav class="px-4 space-y-1 text-sm">
        <a href="index.html" class="flex px-4 py-3 rounded-xl hover:bg-blue-500/10">Overview</a>
        <a href="earn.html" class="flex px-4 py-3 rounded-xl hover:bg-blue-500/10">Earn</a>
        <a href="create-mission.html" class="flex px-4 py-3 rounded-xl hover:bg-blue-500/10">Create Mission</a>
        <a href="badge.html" class="flex px-4 py-3 rounded-xl hover:bg-blue-500/10">Badge</a>
        <a href="leaderboard.html" class="flex px-4 py-3 rounded-xl hover:bg-blue-500/10">Leaderboard</a>
        <a class="flex px-4 py-3 rounded-xl opacity-50">Claim (Soon)</a>
        <a href="wallet.html" class="flex px-4 py-3 rounded-xl hover:bg-blue-500/10">Wallet</a>
        <a class="flex px-4 py-3 rounded-xl bg-blue-500/10 text-blue-400">Profile</a>
        <a href="raffle.html" class="flex px-4 py-3 rounded-xl hover:bg-blue-500/10">Raffle</a>
      </nav>
    </div>

    <div class="p-4 border-t border-blue-400/10">
      <button id="logoutBtn" class="w-full py-2 rounded-xl bg-red-500/10 text-red-400 hover:bg-red-500/20">
        Logout
      </button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="flex-1 p-6 space-y-10">

    <header class="flex justify-between items-center">
      <h1 class="text-2xl font-semibold tracking-wide">Profile</h1>
      <span class="text-xs tracking-widest text-blue-300/70 uppercase">
        Web3 Identity
      </span>
    </header>

    <section class="max-w-4xl mx-auto bg-black/40 backdrop-blur-xl
      rounded-3xl border border-blue-400/20 p-8 space-y-10">

      <!-- AVATAR -->
      <div class="flex flex-col items-center space-y-4">
        <img id="selectedAvatar"
             src="avatar/01.png"
             class="w-24 h-24 rounded-full border border-blue-400/40 object-cover">

        <input type="hidden" id="avatarValue" value="avatar/01.png">

        <p class="text-xs uppercase tracking-widest text-gray-400">
          Selected Avatar
        </p>
      </div>

      <!-- AVATAR PICKER -->
      <div>
        <h3 class="text-sm font-semibold tracking-wide mb-4">
          Choose Your Avatar
        </h3>

        <div class="grid grid-cols-4 md:grid-cols-6 gap-4">
          <img src="avatar/01.png" class="avatar cursor-pointer rounded-full border border-blue-400/20"
            onclick="selectAvatar(this)">
          <img src="avatar/02.png" class="avatar cursor-pointer rounded-full border border-blue-400/20"
            onclick="selectAvatar(this)">
          <img src="avatar/03.png" class="avatar cursor-pointer rounded-full border border-blue-400/20"
            onclick="selectAvatar(this)">
          <img src="avatar/04.png" class="avatar cursor-pointer rounded-full border border-blue-400/20"
            onclick="selectAvatar(this)">
          <img src="avatar/05.png" class="avatar cursor-pointer rounded-full border border-blue-400/20"
            onclick="selectAvatar(this)">
          <img src="avatar/06.png" class="avatar cursor-pointer rounded-full border border-blue-400/20"
            onclick="selectAvatar(this)">
        </div>
      </div>

      <!-- SOCIAL -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <label class="text-xs uppercase tracking-widest text-gray-400">X Username</label>
          <input id="xUsername" class="mt-2 w-full bg-black/30 border border-blue-400/20 rounded-xl px-4 py-3 outline-none focus:border-blue-400" placeholder="@username">
        </div>

        <div>
          <label class="text-xs uppercase tracking-widest text-gray-400">Discord</label>
          <input id="discordUsername" class="mt-2 w-full bg-black/30 border border-blue-400/20 rounded-xl px-4 py-3 outline-none focus:border-blue-400" placeholder="username#0000">
        </div>

        <div>
          <label class="text-xs uppercase tracking-widest text-gray-400">Telegram</label>
          <input id="telegramUsername" class="mt-2 w-full bg-black/30 border border-blue-400/20 rounded-xl px-4 py-3 outline-none focus:border-blue-400" placeholder="@telegram">
        </div>
      </div>

      <div class="flex justify-center">
        <button id="saveProfileBtn"
          class="px-12 py-3 rounded-xl bg-blue-500 hover:bg-blue-600 text-sm font-semibold shadow-lg shadow-blue-500/30">
          Save Profile
        </button>
      </div>

    </section>
  </main>
</div>

<!-- AVATAR UI -->
<script>
  function selectAvatar(el) {
    selectedAvatar.src = el.src
    avatarValue.value = el.src
    document.querySelectorAll('.avatar').forEach(a =>
      a.classList.remove('ring-2','ring-blue-400')
    )
    el.classList.add('ring-2','ring-blue-400')
  }
</script>

<!-- FIREBASE LOGIC -->
<script type="module">
  import { auth, db } from "./firebase.js"
  import { doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
  import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"

  let currentUser

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "login.html"
      return
    }
    currentUser = user

    const snap = await getDoc(doc(db, "users", user.uid))
    if (snap.exists()) {
      const d = snap.data()
      xUsername.value = d.x || ""
      discordUsername.value = d.discord || ""
      telegramUsername.value = d.telegram || ""
      if (d.avatar) {
        selectedAvatar.src = d.avatar
        avatarValue.value = d.avatar
      }
    }
  })

  saveProfileBtn.onclick = async () => {
    await setDoc(doc(db, "users", currentUser.uid), {
      x: xUsername.value,
      discord: discordUsername.value,
      telegram: telegramUsername.value,
      avatar: avatarValue.value,
      updatedAt: Date.now()
    }, { merge: true })

    alert("Profile saved")
  }

  logoutBtn.onclick = async () => {
    await signOut(auth)
    window.location.href = "login.html"
  }
</script>

</body>
</html>